$(document).ready(function(){function a(a){var a=a.filter(function(a){return 0<a.value}).sort((c,a)=>a.value-c.value);console.log(a);var b=300,c=d3.scaleLinear().domain([0,d3.max(a,function(a){return a.value})]).nice().range([b-k.bottom,k.top]),e=d3.scaleBand().domain(d3.range(a.length)).range([k.left,900-k.right]).padding(.1);console.log(c(10));var d=d3.select(".horizChart1").attr("width",900+k.left+k.right).attr("height",b+k.top+k.bottom),f=d.selectAll("g").data(a).enter().append("g");f.append("rect").transition().delay(function(a,b){return 75*b}).attr("width",e.bandwidth()).attr("height",a=>c(0)-c(a.value)).attr("y",a=>c(a.value)).attr("x",(a,b)=>e(b)),f.append("text").transition().delay(function(a,b){return 75*b}).attr("y",a=>c(a.value)-4).attr("x",(a,b)=>e(b)+e.bandwidth()/2).attr("dx",".35em").text(function(a){return a.value}),d.append("g").call(c=>c.attr("transform",`translate(0,${b-k.bottom})`).call(d3.axisBottom(e).tickFormat(b=>a[b].name).tickSizeOuter(0))).selectAll("text").attr("transform","rotate(90)").style("text-anchor","start").attr("x",9).attr("y",0),d.append("g").call(a=>a.attr("transform","translate("+k.left+",0)").call(d3.axisLeft(c)).call(a=>a.select(".domain").remove())),d.append("text").attr("x",540).attr("y",0+k.top).attr("text-anchor","middle").style("font-size","16px").style("text-decoration","underline").text("Obesity Rates by State, 2018")}function b(a){var a=a.filter(function(a){return 0<a.value}).sort((c,a)=>a.value-c.value);console.log(a);var b=300,c=d3.scaleLinear().domain([0,d3.max(a,function(a){return a.value})]).nice().range([b-k.bottom,k.top]),e=d3.scaleBand().domain(d3.range(a.length)).range([k.left,900-k.right]).padding(.1);console.log(c(10));var d=d3.select(".horizChart2").attr("width",900+k.left+k.right).attr("height",b+k.top+k.bottom),f=d.selectAll("g").data(a).enter().append("g");f.append("rect").transition().delay(function(a,b){return 150*b}).attr("width",e.bandwidth()).attr("height",a=>c(0)-c(a.value)).attr("y",a=>c(a.value)).attr("x",(a,b)=>e(b)),f.append("text").transition().delay(function(a,b){return 150*b}).attr("y",a=>c(a.value)-4).attr("x",(a,b)=>e(b)+.5*e.bandwidth()).attr("dx",".35em").text(function(a){return a.value}),d.append("g").call(c=>c.attr("transform",`translate(0,${b-k.bottom})`).call(d3.axisBottom(e).tickFormat(b=>a[b].name).tickSizeOuter(0))).selectAll("text").attr("transform","rotate(90)").style("text-anchor","start").attr("x",9).attr("y",0),d.append("g").call(a=>a.attr("transform","translate("+k.left+",0)").call(d3.axisLeft(c)).call(a=>a.select(".domain").remove())),d.append("text").attr("x",540).attr("y",0+k.top).attr("text-anchor","middle").style("font-size","16px").style("text-decoration","underline").text("Drug Overdoses, 2019")}function c(a){var a=a.filter(function(a){return 0<a.value}).sort((c,a)=>a.value-c.value);console.log(a);var b=300,c={top:20,right:0,bottom:30,left:40},e=d3.scaleLinear().domain([0,d3.max(a,function(a){return a.value})]).nice().range([b-c.bottom,c.top]),f=d3.scaleBand().domain(d3.range(a.length)).range([c.left,900-c.right]).padding(.1);console.log(e(10));var d=d3.select(".horizChart3").attr("width",900+c.left+c.right).attr("height",b+c.top+c.bottom),g=d.selectAll("g").data(a).enter().append("g");g.append("rect").transition().delay(function(a,b){return 150*b}).attr("width",f.bandwidth()).attr("height",a=>e(0)-e(a.value)).attr("y",a=>e(a.value)).attr("x",(a,b)=>f(b)),g.append("text").transition().delay(function(a,b){return 150*b}).attr("y",a=>e(a.value)-4).attr("x",(a,b)=>f(b)+.5*f.bandwidth()).attr("dx",".35em").text(function(a){return a.value}),d.append("g").call(d=>d.attr("transform",`translate(0,${b-c.bottom})`).call(d3.axisBottom(f).tickFormat(b=>a[b].name).tickSizeOuter(0))).selectAll("text").attr("transform","rotate(90)").style("text-anchor","start").attr("x",9).attr("y",0),d.append("g").call(a=>a.attr("transform","translate("+c.left+",0)").call(d3.axisLeft(e)).call(a=>a.select(".domain").remove())),d.append("text").attr("x",540).attr("y",0+c.top).attr("text-anchor","middle").style("font-size","16px").style("text-decoration","underline").text("Age Adjusted Death Rate per 100,000 Individuals, 2019")}function d(a){var b=2*Math.PI,c=d3.arc().innerRadius(70).outerRadius(100).startAngle(0),d=d3.select(".donut"),e=+d.attr("width"),f=+d.attr("height"),h=d.append("g").attr("transform","translate("+e/2+","+f/2+")"),g=h.append("path").datum({endAngle:b}).style("fill","#ddd").attr("d",c),i=h.append("path").datum({endAngle:0*b}).style("fill","orange").attr("d",c),j=d.append("text").text(a).attr("font-size","30px").attr("x","232px").attr("y","152px"),k=d.append("text").text("Risk Score").attr("font-size","30px").attr("x","200px").attr("y","40px");i.transition().duration(1500).attrTween("d",function(a){return function(b){var d=d3.interpolate(b.endAngle,a);return function(a){return b.endAngle=d(a),c(b)}}}(a/100*b))}function e(a,b){o(b,a),p(a),q(a)}function f(a){g="/"+a,$.get("/api/user"+g,function(a){console.log(a),console.log(a.state),console.log(a.gender);var b=a.state,c=a.gender,f=a.total_score;e(b,c),d(f)})}var g,h=window.location.search;-1!==h.indexOf("?id=")&&(g=h.split("=")[1],f(g));var j=[],k={top:20,right:0,bottom:30,left:30};var l=function(a){j=[];for(let b=0;b<a.length;b++)j.push({name:a[b].locationabbr,value:+a[b].data_value});return console.log(j),j},m=function(a){j=[];for(let b=0;b<a.length;b++)j.push({name:a[b].indicator,value:+a[b].data_value});return console.log("Overdose Output",j),j},n=function(a){j=[];for(let b=0;b<a.length;b++)j.push({name:a[b].cause_name,value:+a[b].aadr});return console.log("Death Output",j),j},o=function(b,c){return $.ajax({url:"https://chronicdata.cdc.gov/resource/hn4x-zwk7.json?gender="+b+"&questionid=Q036&yearend=2018",headers:{Authorization:"Basic cd2rpbjy5noro8o4vwvoxbdpi3yaa2ync433cv24bs956nwn3slkqkp4ciaowcdko8mndnr35ax"},method:"GET",data:{$limit:5e3}}).done(function(d){console.log("Retrieved "+d.length+" records from the dataset!"),console.log("Obesity Data",d),console.log(b),console.log(c),l(d),a(j,c),console.log(j)})},p=function(a){var c="https://data.cdc.gov/resource/xkb8-kh2a.json?year=2019&month=February&state_name="+a+"&$where=indicator in('Cocaine (T40.5)', 'Heroin (T40.1)',"+escape("'Natural & semi-synthetic opioids (T40.2)'")+",'Opioids (T40.0-T40.4,T40.6)', 'Psychostimulants with abuse potential (T43.6)', 'Synthetic opioids, excl. methadone (T40.4)', 'Methadone (T40.3)')";return $.ajax({url:c,headers:{Authorization:"Basic cd2rpbjy5noro8o4vwvoxbdpi3yaa2ync433cv24bs956nwn3slkqkp4ciaowcdko8mndnr35ax"},method:"GET",data:{$limit:5e3}}).done(function(c){console.log("Retrieved "+c.length+" records from the dataset!"),console.log("Overdose data",c),console.log(a),m(c),b(j)})},q=function(a){return $.ajax({url:"https://data.cdc.gov/resource/bi63-dtpu.json?year=2017&state="+a,headers:{Authorization:"Basic cd2rpbjy5noro8o4vwvoxbdpi3yaa2ync433cv24bs956nwn3slkqkp4ciaowcdko8mndnr35ax"},method:"GET",data:{$limit:5e3}}).done(function(a){console.log("Retrieved "+a.length+" records from the dataset!"),console.log("Death Cause Data",a),n(a),c(j)})}});